<!DOCTYPE html>
<html lang="fi">
<head>
	<meta charset="UTF-8">
	<meta name="description" content="Reittiopas">
	<meta name="keywords" content="XeduR, Koodihaaste, Solidabis, Reittiopas">
	<meta name="author" content="Eetu Rantanen">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans">
	<link rel="stylesheet" href="./css/styles.css">
    <script src="js/routePlanner.js"></script>
</head>

<body>
    <h1>Reittiopas</h1>
    <h2><a href="https://koodihaaste.solidabis.com/">Solidabis - Koodihaaste</a></h2>
	<div id="wrapper">
        <div id="error"></div>

        <noscript>
            <h4>
                Reittioppaan käyttö vaatii JavaScriptin. Varmistathan,<br>
                ettei selaimesi tai sen jokin lisäosa estä JavaScriptiä.
            </h4>
        </noscript>

        <h3>Lähtöpysäkki</h3>
        <p id="start"></p>

        <h3>Määränpää</h3>
        <p id="end"></p>

        <!-- Käytä värejä koodihaasteen sivuilta.
        1) sininen header,
        2) harmaa tausta,
        3) linjoilla omat värit,
        4) pysäkit kaikki samanvärisiä. -->

        <script>
            var busStops, routes, prevButtonA, prevButtonB;

            function checkRoute( a, b ) {
                if (a == b) {
                    console.log( "Start and end are the same." )
                } else {
                    console.log( "checkRoute:", a, b );
                    getRoute();
                }
            }


            function buttonListener( pressed ) {
                var sameButton;

                if (pressed.loc == "start") {
                    if (prevButtonA) {
                        prevButtonA.style.backgroundColor = "#007ac9";
                    }
                    if (!prevButtonA || prevButtonA != pressed) {
                        prevButtonA = pressed;
                    } else {
                        prevButtonA = false;
                        sameButton = true;
                    }
                } else {
                    if (prevButtonB) {
                        prevButtonB.style.backgroundColor = "#007ac9";
                    }
                    if (!prevButtonB || prevButtonB != pressed) {
                        prevButtonB = pressed;
                    } else {
                        prevButtonB = false;
                        sameButton = true;
                    }
                }

                if (!sameButton) {
                    pressed.style.backgroundColor = "#1abf34";
                    if (prevButtonA && prevButtonB) {
                        checkRoute( prevButtonA.node, prevButtonB.node );
                    }
                }
            }


            function createButtons( i, loc ) {
                var div = document.getElementById( loc );
                var btn = document.createElement("button");
                btn.innerHTML = routes.pysakit[i];
                btn.node = routes.pysakit[i];
                btn.loc = loc;
                btn.addEventListener( "click", function() {
                    buttonListener( btn );
                });
                div.appendChild( btn );
            }


            fetch('./reittiopas.json')
            .then(response => {
                return response.json()
            })
            .then(data => {
                routes = data;
				// busStops = prepareRoutes( routes );
                for ( let i = 0; i < routes.pysakit.length; i++ ) {
                    createButtons( i, "start" );
                }
                for ( let i = 0; i < routes.pysakit.length; i++ ) {
                    createButtons( i, "end" );
                }
            })
            .catch(err => {
                document.getElementById("error").innerHTML = "<h4>Reittoppaan lataamisessa tapahtui virhe. Yritäthän uudelleen.</h4>";
            })


        </script>
    </div>
    <footer><p>Copyright © 2020 Eetu Rantanen</p></footer>
</body>
</html>

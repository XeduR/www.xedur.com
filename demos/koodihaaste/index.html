<!DOCTYPE html>
<html>
    <head>
        <style>
            button {
                background: blue;
                color: white;
                border-radius: 20px;
                height: 40px;
                width: 40px;
                font-size: 24;
            }
        </style>
    </head>

    <h1>Reittiopas</h1>
    <h2>Solidabis - Koodihaaste</h2>
    <h3 id="error"></h3>

    <noscript>
        <h3>
            Reittioppaan käyttö vaatii JavaScriptin. Varmistathan,<br>
            ettei selaimesi tai sen jokin lisäosa estä JavaScriptiä.
        </h3>
    </noscript>

    <p>Lähtöpysäkki</p>
    <p id="start"></p>

    <p>Määränpää</p>
    <p id="end"></p>

    <!-- Käytä värejä koodihaasteen sivuilta.
    1) sininen header,
    2) harmaa tausta,
    3) linjoilla omat värit,
    4) pysäkit kaikki samanvärisiä. -->

    <script>
        var routes, prevButtonA, prevButtonB;

        function checkRoute( a, b ) {
            console.log( "checkRoute:", a, b );
        }


        function buttonListener( pressed ) {
            var sameButton;

            if (pressed.loc == "start") {
                if (prevButtonA) {
                    prevButtonA.style.backgroundColor = "blue";
                }
                if (!prevButtonA || prevButtonA != pressed) {
                    prevButtonA = pressed;
                } else {
                    prevButtonA = false;
                    sameButton = true;
                }
            } else {
                if (prevButtonB) {
                    prevButtonB.style.backgroundColor = "blue";
                }
                if (!prevButtonB || prevButtonB != pressed) {
                    prevButtonB = pressed;
                } else {
                    prevButtonB = false;
                    sameButton = true;
                }
            }

            if (!sameButton) {
                pressed.style.backgroundColor = "green";
                if (prevButtonA && prevButtonB) {
                    checkRoute( prevButtonA.node, prevButtonB.node );
                }
            }
        }


        function createButtons( i, loc ) {
            var div = document.getElementById( loc );
            var btn = document.createElement("button");
            btn.innerHTML = routes.pysakit[i];
            btn.node = routes.pysakit[i];
            btn.loc = loc;
            btn.addEventListener( "click", function() {
                buttonListener( btn );
            });
            div.appendChild( btn );
        }


        fetch('./reittiopas.json')
        .then(response => {
            return response.json()
        })
        .then(data => {
            routes = data;
            for ( var i = 0; i < routes.pysakit.length; i++ ) {
                createButtons( i, "start" );
            }
            for ( var i = 0; i < routes.pysakit.length; i++ ) {
                createButtons( i, "end" );
            }
        })
        .catch(err => {
            document.getElementById("error").innerHTML = "Reittoppaan lataamisessa tapahtui virhe. Yritäthän uudelleen.";
        })


        </script>
    </body>
</html>
